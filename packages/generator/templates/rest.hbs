fastify.route({
  method: {{#if (isAllMethod method)}}['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT', 'OPTIONS']{{else}}'{{method}}'{{/if}},
  url: '{{url}}',
  schema: {{json schema}},
  //@ts-ignore - we may have unused params
  handler: async (request, reply) => {
    {{#each parameters}}
      {{#if helper}}
        {{helper}}

        if (reply.sent) {
          return;
        }
        
       {{/if}}
    {{/each}}

    const data = await {{controllerName}}.{{controllerMethod}}.apply(context, [{{paramsToString parameters}}]);
    
    if (reply.sent) {
      //@ts-ignore - When {{controllerName}}.{{controllerMethod}}() returns nothing, typescript gets mad.
      if (data) {
        const error = new Error('Reply already sent, but controller returned data');
    
        //@ts-expect-error - include data in error to help debugging
        error.data = data;
        
        return error;
      }

      return;
    }

    return data;
  },
  {{options}}
});